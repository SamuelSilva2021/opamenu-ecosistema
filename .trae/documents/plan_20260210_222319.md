# Plano de Refatoração: Gestão de Pessoas e Colaboradores

A estrutura atual mistura "Identidade" com "Acesso". Vamos separar esses conceitos para permitir colaboradores sem login (ex: entregadores terceiros) e organizar melhor os clientes.

## 1. Diagnóstico Atual
| Entidade | Responsabilidade Atual | Status |
| :--- | :--- | :--- |
| **UserAccount** | Login, Autenticação e Perfil de Acesso (Sistema) | ✅ Implementado |
| **Customer** | Cliente Final (Quem compra) | ✅ Implementado |
| **TenantCustomer** | Vínculo do Cliente com a Loja (CRM) | ✅ Implementado |
| **Collaborator** | Funcionário/Parceiro (Quem trabalha) | ❌ **Ausente** (Atualmente forçado em UserAccount) |

## 2. Nova Arquitetura Proposta

### Nova Entidade: `Collaborator` (ou `Person`)
Esta entidade representará qualquer pessoa que trabalha ou presta serviço para o estabelecimento, **independente de ter login ou não**.

**Estrutura Sugerida:**
- `Id`: UUID
- `TenantId`: UUID (Vinculado à loja)
- `Name`: String (Nome completo)
- `Type`: Enum (`Internal`, `External/ThirdParty`)
- `Role`: String (ex: "Entregador", "Garçom", "Gerente") - *Apenas informativo*
- `Phone`: String (Opcional, para contato)
- `UserAccountId`: UUID (Nullable) -> **Chave de Ouro**: Se preenchido, essa pessoa tem acesso ao sistema. Se nulo, é apenas um cadastro (ex: motoboy terceiro).
- `Active`: Bool

### Fluxo de Uso
1.  **Entregador Próprio (com App):** Cria `Collaborator` + Cria `UserAccount` e vincula os dois.
2.  **Entregador Terceiro (sem App):** Cria apenas `Collaborator` (Tipo: External). Aparece na lista de seleção, mas não loga.
3.  **Garçom:** Cria `Collaborator` + `UserAccount`.

## 3. Plano de Implementação

### Fase 1: Backend (.NET)
1.  [ ] Criar entidade `CollaboratorEntity` no `OpaMenu.Infrastructure.Shared`.
2.  [ ] Criar Enum `CollaboratorType` (Internal, External).
3.  [ ] Atualizar `OrderEntity`:
    -   Alterar `DriverId` para apontar para `Collaborator.Id` (e não `UserAccount.Id`).
    -   *Nota: Isso exigirá migration.*
4.  [ ] Criar `CollaboratorService` e `CollaboratorController` (CRUD completo).

### Fase 2: Frontend (Flutter)
1.  [ ] Criar nova tela **"Colaboradores"** (separada de "Usuários do Sistema").
    -   Aba 1: Lista de Colaboradores (com indicador de quem tem acesso ao sistema).
    -   Formulário: Nome, Tipo, Telefone. Opção "Conceder Acesso ao Sistema" (que abre o fluxo de criar UserAccount).
2.  [ ] Atualizar o Modal de Seleção de Entregador (`SelectDriverDialog`) para listar `Collaborators` (filtrando por tipo ou cargo) em vez de `Users`.

## 4. Próximos Passos Imediatos
Recomendo começarmos pelo **Backend**: criando a entidade e a migração. Aceita seguir por esse caminho?